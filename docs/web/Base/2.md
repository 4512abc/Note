# JS日期、年月日、时分秒的无敌秘籍，文艺之行

JS中的日期时间应用场景是非常广阔的，比如说：页面监控、评论提交、文章发布、内容编辑、节日活动等等，有生命的地方就存在时间。

这里汇总了所有常见转换以及无敌的操作，以后再也不用去百度一顿搜索了，直接来这里（CTRL+C）


## 当前标准时间

先来获取一下当前的标准时间，参数为指定字符，位置可随意，传啥有啥！

```js
function format(fmt) {
    const date = new Date()
    const o = {
        "Y+": date.getFullYear(),
        "M+": date.getMonth() + 1,     // 月
        "D+": date.getDate(),          // 日
        "h+": date.getHours(),         // 时
        "m+": date.getMinutes(),       // 分
        "s+": date.getSeconds(),       // 秒
    }
    for (var k in o) {
       if (new RegExp("("+ k +")").test(fmt)) {
            fmt = fmt.replace(RegExp.$1, () => {
                if (k === 'Y+' || RegExp.$1.length == 1) {    // 年份 or 小于10不加0
                    return o[k]
                } else {
                    return ("00"+ o[k]).substr(("" + o[k]).length)  // 小于10补位0
                }
            })
        }
    }
    return fmt
}
format("YYYY-MM-DD hh:mm:ss")   // 2021-03-21 20:24:32
format("MM/DD/YYYY hh:mm")      // 03-21-2021 20:24
format("YYYY年MM月DD日 hh:mm:ss")// 2021年03月21日 20:30:14
```

## 时间戳转换

我们在数据库存储时间字段的时候，一般都会以时间戳的标准来存储。

在前端展示的时候，又该怎样让它变成一个正常的时间呢！

首先来获取一下当前的时间戳，有以下三种方式：

```js
new Date().getTime()    // 精确到毫秒
new Date().valueOf()    // 精确到毫秒
Date.parse(new Date())  // 精确到秒

// 第一个得到：1616330071538
```

我们接着改造上面的方法：

```js
function format(fmt, timestamp) {
    const date = timestamp ? new Date(timestamp) : new Date()
    // ....
}
const a = format("YYYY-MM-DD hh:mm:ss")
const b = format("YYYY年MM月DD日 hh:mm:ss", 1616330071538)
// a: 2021-03-21 20:48:30
// b: 2021年03月21日 20:34:31
```

再添加一个时间戳的参数，只需把时间戳传进日期对象即可。


## 很久以前

很久以前如果我们不曾相遇，如果没人说出那些话，那我们现在还会不会是朋友。偶然看到我们的聊天记录，时间停留在去年的某一个冬天，最后的信息让手机冷了心！

如果能像计算器一样归零，那么你是否会选择重新开始？

```js
const time = (timestemp) => {
    const minute = 1000 * 60;
    const hour = minute * 60;
    const day = hour * 24;
    const month = day * 30;
    const year = month * 12;
    const diffValue = new Date().getTime() - timestemp; // 当前时间戳-原时间戳=相差时间

    // 如果本地时间反而小于变量时间
    if (diffValue <= 0) {
        return '现在'
    }

    // 计算差异时间的量级
    const yearC = diffValue / year;
    const monthC = diffValue / month;
    const weekC = diffValue / (7 * day);
    const dayC = diffValue / day;
    const hourC = diffValue / hour;
    const minC = diffValue / minute;

    // 从大到小排序 满足1以上即成立
    const map = {
        [yearC]: '年',
        [monthC]: "月",
        [weekC]: "周",
        [dayC]: "天",
        [hourC]: "小时",
        [minC]: "分",
    }
    for (let i in map) {
        if (i >= 1) {
            return `${parseInt(i)}${map[i]}前`
        }
    }
}
console.log(time(new Date().getTime()))                 // 现在
console.log(time(new Date('2021-1-11').getTime()))      // 2月前
console.log(time(new Date('2021-2-22').getTime()))      // 3周前
console.log(time(new Date('2020-3-11').getTime()))      // 1年前
console.log(time(new Date('2019-3-11').getTime()))      // 2年前
console.log(time(new Date(1616330071538).getTime()))    // 1小时前
```

## 时间范围

一个常见的场景，咨询客服，当前时间是否在服务时间内：

例如：客服上班时间（08:00-20:00）（08:30-20:30）

```js
// 第一种 很简单
function time(beginTime, endTime){
    const timeNow = new Date().getHours()
    return timeNow >= beginTime && timeNow < endTime
}
time(8, 20)

// 第二种 升级版
function times(beginTime, endTime){
    const bDate = beginTime.split(':')
    const eDate = endTime.split(':')
    
    const o = {}
    const s = ['nDate', 'bDate', 'eDate']

    for (let i of s) {
        o[i] = new Date()
        let hours, minute;
        if (i == 'nDate') {
            hours = o[i].getHours()
            minute = o[i].getMinutes()
        } else {
            const arr = i == 'bDate' ? bDate : eDate
            hours = arr[0]
            minute = arr[1] || 0
        }
        o[i].setHours(hours)
        o[i].setMinutes(minute)
    }
    // 当前、开始、结束，三者的时间戳进行对比，答案就很清晰明了
    return o.nDate.getTime() - o.bDate.getTime() > 0 && o.nDate.getTime() - o.eDate.getTime() < 0
}
// 两种都支持
console.log(times('8', '22'))
console.log(times('8:30', '22:54'))
```


```js

```

## 无敌且随意搭配，文艺



```js


```
